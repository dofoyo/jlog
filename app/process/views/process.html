<div>
    <button type="button" ng-click="setCreateShow()" class="btn btn-success">发起</button>
    <button type="button" ng-click="setTodoShow()" class="btn btn-primary">待办</button>
    <button type="button" ng-click="setDoneShow()" class="btn btn-info">已办</button>
</div>
<br>
<div ng-show="pageState.createShow">
    <input type="text" class="form-control" placeholder="主题" ng-model="process.subject">
    <TEXTAREA ROWS="4" ng-model="process.description" class="form-control" placeholder="详细阐述"></TEXTAREA>
    <button type="button" ng-click="create();" class="btn btn-default">提交</button>
</div>

<div ng-show="pageState.todoShow">
    <div class="input-group">
        <div class="radio-inline">
            <label>
                <input type="radio" name="todo" id="todo1" value="1" ng-click="getExecutes()" checked>
                待处理
            </label>
        </div>
        <div class="radio-inline">
            <label>
                <input type="radio" name="todo" id="todo2" value="2" ng-click="getAdvises()">
                待签
            </label>
        </div>
        <div class="radio-inline">
            <label>
                <input type="radio" name="todo" id="todo3" value="3" ng-click="getReads()" >
                待阅
            </label>
        </div>
    </div>
</div>

<div ng-show="pageState.doneShow">
    <div class="input-group">
        <div class="radio-inline">
            <label>
                <input type="radio" name="done" id="done2" value="2" ng-click="getNotCompleted()" checked>
                未结束
            </label>
        </div>
        <div class="radio-inline">
            <label>
                <input type="radio" name="done" id="done1" value="1" ng-click="getCompleted()">
                已完成
            </label>
        </div>
        <div class="radio-inline">
            <label>
                <input type="radio" name="done" id="done3" value="3" ng-click="getStoped()">
                已终止
            </label>
        </div>
    </div>
</div>

<div ng-show="pageState.doneShow || pageState.todoShow">
    <div class="input-group">
        <span class="input-group-addon">关键字：</span>
        <input type="text" ng-model="pageState.keyWord" class="form-control" />
        <span class="input-group-btn">
            <button type="button" ng-click="find();" class="btn btn-default">GO</button>
       </span>
    </div>
</div>

<br>

<div>
<ul class="list-group">
    <li ng-repeat="process in processes" class="list-group-item">
        <div ng-click="setDetailDivShow($index)">
            <span class="badge">{{$index+1}}</span>
            <span class="text-info">{{process.creator.name}}</span>
            <span class="text-muted">({{process.creator.department}})</span><br>
            <span class="text-primary">{{process.subject}}</span>
            <span class="text-muted">({{process.createDatetime  | date:'yyyy-MM-dd hh:mm:ss'}})</span>
        </div>
        <div  ng-class="{detailDivShow: $index!=pageState.index || pageState.detailDivShow}">
            <span class="text-primary">{{process.description}}</span>

            <ul>
                <li ng-repeat="comment in process.comments">
                    <span class="text-info">{{comment.creator.name}}</span>
                    <span class="text-muted">({{comment.creator.department}})</span><br>
                    <span class="text-primary">{{comment.message | attachmentName}}</span>
                    <span ng-show="{{comment.message | hasAttachment}}"><a href="{{comment.message | attachmentUrl}}" target="_blank">下载</a></span>
                    <span class="text-muted">({{comment.datetime  | date:'yyyy-MM-dd hh:mm:ss'}})</span>
                </li>
            </ul>

            <div class="btn-toolbar">
                <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-show="pageState.yesBtnShow">
                        <abbr title="流程通过本节点">通过</abbr>
                    </button>
                    <button type="button" class="btn btn-default" ng-show="pageState.noBtnShow">
                        <abbr title="流程返回到上一节点">驳回</abbr>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-show="pageState.setUserBtnShow" ng-click="setDivShow('userDivShow')">
                        <abbr title="未关闭、未终止的流程，发起人和当前人可随时新增其他人员。执行人会对流程的流向直接产生影响，知会人可发表意见，也可不发表意见，不会直接改变流程的流向">人员</abbr>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-show="pageState.sayBtnShow" ng-click="setDivShow('commentDivShow')">
                        <abbr title="未关闭、未终止的流程，参与者可随时发言，不会直接改变流程的流向">发言</abbr>
                    </button>
                    <button type="button" class="btn btn-default" ng-show="pageState.sayBtnShow" ng-click="setDivShow('attachmentDivShow')">
                        <abbr title="未关闭、未终止的流程，参与者可随时加附件，不会直接改变流程的流向">附件</abbr>
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-show="pageState.stopBtnShow">
                        <abbr title="未完成的流程可被发起人和当前处理人强制终止，终止状态的流程除加入知会人外，其他操作都被禁止。">终止</abbr>
                    </button>
                    <button type="button" class="btn btn-default" ng-show="pageState.restartBtnShow">
                        <abbr title="流程完成后自动关闭，关闭状态的流程除加入知会人外，其他操作都被禁止。流程发起人或处理人可重启已关闭或终止的流程，流程将按新增人员运行">重启</abbr>
                    </button>
                </div>
            </div>

            <div  ng-class="{commentDivShow: $index!=pageState.index || pageState.commentDivShow}">
                <TEXTAREA NAME="" ROWS="2" COLS="20" ng-model="process.comment"  class="form-control"></TEXTAREA>
                <button type="button" ng-click="submitComment($index);" class="btn btn-default">提交</button>
            </div>
            <div  ng-class="{attachmentDivShow: $index!=pageState.index || pageState.attachmentDivShow}">
                <br>
                <input ng-file-select type="file" multiple/>
                <table class="table">
                    <tbody>
                    <tr ng-repeat="item in uploader.queue">
                        <td><strong>{{ item.file.name }}</strong></td>
                        <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td>
                        <td ng-show="uploader.isHTML5">
                            <div class="progress" style="margin-bottom: 0;">
                                <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
                            </div>
                        </td>
                        <td class="text-center">
                            <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                            <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                            <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                        </td>
                        <td nowrap>
                            <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                <span class="glyphicon glyphicon-trash"></span>  删除
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div>
                    <p>
                    <div class="progress" style="">
                        <div class="progress-bar" role="progressbar" ng-style="{ 'width': uploader.progress + '%' }"></div>
                    </div>
                    </p>
                    <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length">
                        <span class="glyphicon glyphicon-upload"></span> 上传
                    </button>
                    <button type="button" class="btn btn-warning btn-s" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading">
                        <span class="glyphicon glyphicon-ban-circle"></span> 取消
                    </button>
                    <button type="button" class="btn btn-danger btn-s" ng-click="uploader.clearQueue()" ng-disabled="!uploader.queue.length">
                        <span class="glyphicon glyphicon-trash"></span> 删除
                    </button>
                </div>
            </div>
            <div  ng-class="{userDivShow: $index!=pageState.index || pageState.userDivShow}">
                <div class="input-group">
                    <span class="input-group-addon">查找：</span>
                    <input type="text" ng-model="pageState.userName" class="form-control" placeholder="请输入姓名的关键字"/>
                    <span class="input-group-btn">
                        <button type="button" ng-click="getUsers()" class="btn btn-default">GO</button>
                   </span>
                </div>
                <div ng-repeat="executer in process.executers" class="panel panel-primary">
                        <div class="panel-heading">
                            <span class="badge">{{$index+1}}</span>
                            执行人：{{executer.name}}
                            <div class="pull-right"><button type="button" class="btn btn-default btn-xs" ng-click="delExecuter($index)">取消</button></div>
                            <br>
                            {{executer.department}}
                        </div>
                </div>
                <div ng-repeat="adviser in process.advisers" class="panel panel-info">
                        <div class="panel-heading">
                            <span class="badge">{{$index+1}}</span>
                            会签人：{{adviser.name}}
                            <div class="pull-right"><button type="button" class="btn btn-default btn-xs" ng-click="delAdviser($index)">取消</button></div>
                            <br>
                            {{adviser.department}}
                        </div>
                </div>
                <div ng-repeat="user in pageState.users" class="panel panel-default">
                        <div class="panel-body">
                            {{user.userName}}
                            <div class="pull-right">
                            <button type="button" class="btn btn-default btn-xs" ng-click="addExecuter($index)">执行人</button>
                            <button type="button" class="btn btn-default btn-xs" ng-click="addAdviser($index)">会签人</button>
                            </div>
                            <br>
                            {{user.department}}
                        </div>
                </div>
            </div>
        </div>
    </li>
</ul>
<hr>
<button type="button" ng-click="getMore();" ng-show="pageState.hasMore" class="btn btn-default">更多</button>
</div>

<script>
    $('#myTab a[href="#process"]').tab('show');
</script>


<style type="text/css">
    .detailDivShow {
        display:none;
    }
    .commentDivShow {
        display:none;
    }
    .attachmentDivShow {
        display:none;
    }
    .userDivShow {
        display:none;
    }

    .panel_container{
        float: left;
        margin:10px;
        border-color: #FFFFFF;
    }
</style>

<div ng-show="false">
    todo:
    1、执行人和会签人的comment分左右排列
    2、只有创建人和当前的执行人有权限加入人员
    3、根据comment包含createDatetime和completeDatetime,即使创建人或知会人被从executers和advisers去除后，也能计算其用了多少小时才完成此项工作
    4、在comments中有记录即为已办
    5、在executers和advisers有记录即为待办
    6、在reads中有记录即为待阅
    7、process.logs记载加入人员、取消人员的操作
    8、process.executers.executer要有独立的ID，不然无法正确删除。

</div>